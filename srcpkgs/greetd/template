# Template file for 'greetd'
pkgname=greetd
version=0.7.0
revision=1
build_style=cargo
conf_files="/etc/greetd/config.toml"
hostmakedepends="scdoc"
makedepends="pam-devel"
short_desc="Minimal and flexible login manager daemon"
maintainer="cinerea0 <cinerea0@protonmail.com>"
license="GPL-3.0-or-later"
homepage="https://git.sr.ht/~kennylevinsen/greetd"
distfiles="https://git.sr.ht/~kennylevinsen/${pkgname}/archive/${version}.tar.gz"
checksum=5229b7f00be40187de9df6240fc3b1f4012dd5e4777bb8661016cc7c2c105df7

system_accounts="_greeter"
_greeter_groups="video"
_greeter_homedir="/var/lib/_greeter"
make_dirs="/var/lib/_greeter 0755 _greeter _greeter"

pre_build() {
	for i in man/*.scd; do
		scdoc < "$i" > "${i:: -4}"
	done

	for f in man/*-[0-9]; do
		num="${f: -1}"
		mv "$f" "${f/-$num/.$num}"
	done
}

do_install() {
	vbin "target/${RUST_TARGET}/release/agreety"
	vbin "target/${RUST_TARGET}/release/fakegreet"
	vbin "target/${RUST_TARGET}/release/greetd"
	vinstall config.toml 644 etc/greetd/

	for i in man/*.[0-9]; do
		vman "$i"
	done

	vinstall ${FILESDIR}/greetd.pam 644 etc/pam.d/ greetd
	vsv greetd
	vdoc "${FILESDIR}/README.voidlinux"
}
